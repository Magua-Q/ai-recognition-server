<view class="container">
  <view class="title">📷 AI 拍照识物</view>

  <!-- 模型加载提示 -->
  <view wx:if="{{isModelLoading}}" class="loading">
    🔄 AI 模型加载中，请稍候...
  </view>

  <!-- 错误提示 -->
  <view wx:if="{{error}}" class="error">
    {{error}}
  </view>

  <!-- 摄像头预览 -->
  <view class="card">
    <camera
      id="camera"
      device-position="back"
      flash="off"
      style="width: 100%; height: 600rpx; border-radius: 20rpx;"
      wx:if="{{isCameraActive}}">
    </camera>

    <view wx:if="{{!isCameraActive && !error}}" class="camera-placeholder" style="text-align: center; padding: 100rpx; color: #999;">
      <text style="font-size: 120rpx; display: block; margin-bottom: 20rpx;">📷</text>
      <text>点击下方按钮启动摄像头</text>
    </view>
  </view>

  <!-- 控制按钮 -->
  <view class="controls">
    <button
      class="btn btn-primary {{(isLoading || isCameraActive || isModelLoading) ? 'btn-disabled' : ''}}"
      bindtap="startCamera"
      disabled="{{isLoading || isCameraActive || isModelLoading}}">
      {{isCameraActive ? '摄像头已启动' : '启动摄像头'}}
    </button>

    <button
      class="btn btn-capture {{(!isCameraActive || isLoading || isModelLoading) ? 'btn-disabled' : ''}}"
      bindtap="captureAndClassify"
      disabled="{{!isCameraActive || isLoading || isModelLoading}}">
      {{isLoading ? '识别中...' : '拍照识别'}}
    </button>

    <button
      class="btn btn-stop {{!isCameraActive ? 'btn-disabled' : ''}}"
      bindtap="stopCamera"
      disabled="{{!isCameraActive}}">
      停止摄像头
    </button>
  </view>

  <!-- 识别结果 -->
  <view wx:if="{{predictions.length > 0}}" class="card">
    <view style="font-size: 36rpx; font-weight: bold; margin-bottom: 30rpx; color: #333;">
      🎯 识别结果
    </view>
    <view wx:for="{{predictions}}" wx:key="index" class="result-item">
      <view class="result-label">{{item.className}}</view>
      <view class="confidence-bar">
        <view class="confidence-fill" style="width: {{item.probability}}%;"></view>
      </view>
      <view class="confidence-text">{{item.probability}}%</view>
    </view>
  </view>
</view>
