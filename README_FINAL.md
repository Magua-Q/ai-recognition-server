# 📷 AI 拍照识物微信小程序

## 🎯 项目简介

这是一个功能完整的微信小程序 AI 图像识别应用，支持实时摄像头拍照和智能识别物体。

## ✨ 功能特性

- 📷 **实时摄像头预览** - 调用小程序 camera 组件
- 🎯 **AI 图像识别** - 智能识别物体类别和名称
- 📊 **置信度展示** - 显示识别结果的置信度百分比
- 🎨 **现代 UI 设计** - 渐变背景、卡片式布局，居中显示
- ⚡ **流畅体验** - 优化的加载和交互状态
- 🛡️ **安全可靠** - 支持云函数和服务器代理两种方案

## 🏗️ 架构方案

项目支持**两种**AI 识别方案：

### 方案一：服务器代理（推荐）⭐⭐⭐⭐⭐

**架构**：
```
小程序 → 你的服务器 → 腾讯云 API
```

**优势**：
- ✅ 完全可控的服务器
- ✅ 可自定义业务逻辑
- ✅ 支持并发处理
- ✅ 易于扩展和监控
- ✅ 可部署到任意云平台

**文件**：
- `server/` - 完整的 Node.js 服务器实现
- `pages/index/index.js` - 小程序调用代码
- `SERVER_DEPLOYMENT_GUIDE.md` - 详细部署指南

### 方案二：微信云函数

**架构**：
```
小程序 → 微信云函数 → 腾讯云 API
```

**优势**：
- ✅ 无需管理服务器
- ✅ 自动扩缩容
- ✅ 与微信生态深度集成
- ✅ 开发简单快速

**文件**：
- `cloudfunctions/` - 云函数代码
- 文档已集成在 `AI_API_GUIDE.md`

## 📂 项目结构

```
d:\code\paizhaoshibie/
├── 📄 README.md                    # 项目说明
├── 📄 QUICK_START.md              # 5分钟快速开始
├── 📄 AI_API_GUIDE.md             # API 集成指南
├── 📄 API_KEY_TUTORIAL.md         # 密钥创建详细教程
├── 📄 SERVER_DEPLOYMENT_GUIDE.md  # 服务器部署指南
├── 📄 UI_FIX.md                   # UI 居中显示修复说明
│
├── 📁 server/                     # 服务器代理方案
│   ├── index.js                   # Express 服务器
│   ├── package.json               # 依赖配置
│   └── .env.example               # 环境变量示例
│
├── 📁 cloudfunctions/             # 云函数方案
│   └── classify/
│       ├── index.js               # 云函数入口
│       └── package.json           # 依赖配置
│
├── 📁 pages/index/                # 小程序页面
│   ├── index.js                   # 页面逻辑
│   ├── index.wxml                 # 页面结构
│   ├── index.wxss                 # 页面样式
│   └── index.json                 # 页面配置
│
├── 📄 app.js                      # 小程序入口
├── 📄 app.json                    # 全局配置
├── 📄 app.wxss                    # 全局样式
├── 📄 project.config.json         # 项目配置
└── 📄 sitemap.json                # 索引配置
```

## 🚀 快速开始

### 第一步：选择方案

**新手推荐** → **服务器代理**（方案一）
- 文档详细，示例完整
- 易于理解服务器工作原理
- 方便后续扩展

**企业推荐** → **云函数**（方案二）
- 无需服务器运维
- 成本更低
- 开发更快

### 第二步：获取 API 密钥

详细步骤请参考：[API_KEY_TUTORIAL.md](./API_KEY_TUTORIAL.md)

支持的云服务商：
- ✅ 腾讯云（推荐 - 免费额度高）
- ✅ 百度云（推荐 - 价格便宜）
- ✅ 阿里云（推荐 - 功能全面）

### 第三步：部署

#### 选择方案一：服务器代理

**阅读**：[SERVER_DEPLOYMENT_GUIDE.md](./SERVER_DEPLOYMENT_GUIDE.md)

**快速启动**：
```bash
cd server
npm install
cp .env.example .env
# 编辑 .env，填入你的 API 密钥
npm start
```

**小程序配置**：
1. 修改 `pages/index/index.js` 中的服务器地址
2. 在小程序后台配置域名白名单

#### 选择方案二：云函数

**阅读**：[AI_API_GUIDE.md](./AI_API_GUIDE.md) 中的"云函数调用"部分

**快速启动**：
1. 在微信开发者工具中开通云开发
2. 右键 `cloudfunctions/classify` → "上传并部署"
3. 设置环境变量（API 密钥）
4. 编译运行

### 第四步：测试

1. 在微信开发者工具中打开项目
2. 点击"启动摄像头"
3. 拍照并查看识别结果

## 📱 小程序功能演示

### 主要界面

1. **首页** - 显示标题和摄像头预览
2. **控制按钮** - 启动/停止摄像头、拍照识别
3. **结果展示** - 显示识别物体和置信度

### 操作流程

```
启动摄像头 → 拍照 → 识别 → 显示结果
```

### UI 特点

- 渐变背景（紫色到粉色）
- 卡片式布局
- 圆角按钮和容器
- 置信度进度条
- 响应式设计（完美居中）

## 🔧 技术栈

### 小程序端
- **框架**：微信原生小程序
- **UI**：WXSS + Flexbox
- **摄像头**：camera 组件
- **网络**：wx.request

### 服务器端（方案一）
- **运行时**：Node.js 16+
- **框架**：Express.js 4
- **AI SDK**：腾讯云 SDK
- **进程管理**：PM2
- **反向代理**：Nginx（可选）

### 云函数端（方案二）
- **运行时**：Node.js 8.9/10.15/12.16
- **SDK**：wx-server-sdk
- **AI SDK**：腾讯云 SDK
- **数据库**：云开发数据库（可选）

## 💰 费用预估

### 方案一：服务器代理

| 项目 | 规格 | 价格 |
|------|------|------|
| 云服务器 | 1核1G | ¥24/月 |
| 流量 | 1Mbps | 含套餐 |
| API 调用 | 1000次/天 | ¥300/月 |
| **总计** | | **¥324/月** |

### 方案二：云函数

| 项目 | 规格 | 价格 |
|------|------|------|
| 云开发 | 基础版 | 免费 |
| 云函数 | 512MB 内存 | ¥0.0007/GB-秒 |
| API 调用 | 1000次/天 | ¥300/月 |
| **总计** | | **¥300/月** |

**详细费用对比**：参见 `AI_API_GUIDE.md`

## 🛡️ 安全特性

### 密钥管理
- ✅ 使用环境变量存储密钥
- ✅ 密钥不暴露在小程序代码中
- ✅ 支持密钥轮换
- ✅ 子账号权限限制

### API 安全
- ✅ 请求频率限制
- ✅ 输入数据验证
- ✅ IP 白名单（可选）
- ✅ HTTPS 加密传输

### 数据安全
- ✅ 图片数据不存储
- ✅ 自动清理临时文件
- ✅ 日志脱敏处理

## 📊 性能优化

### 小程序端
- ✅ 图片压缩
- ✅ 请求防抖
- ✅ 加载状态提示
- ✅ 错误重试机制

### 服务器端
- ✅ 连接池复用
- ✅ 响应数据缓存
- ✅ Gzip 压缩
- ✅ CDN 加速（可选）

## 🎓 学习资源

### 官方文档
- [微信小程序开发文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [腾讯云图像识别文档](https://cloud.tencent.com/document/product/865)
- [Express.js 文档](https://expressjs.com/)
- [Node.js 文档](https://nodejs.org/)

### 教程文章
- [云开发入门教程](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/quickstart.html)
- [腾讯云 SDK 使用指南](https://cloud.tencent.com/document/sdk/Node.js)
- [PM2 进程管理](https://pm2.keymetrics.io/docs/usage/quick-start/)

### 视频教程
- B 站搜索："微信小程序 AI 识别"
- 腾讯云开发者社区视频课程

## 🐛 常见问题

### Q1：摄像头无法启动？

**原因**：小程序未获得摄像头权限

**解决**：
1. 确保真机测试（模拟器不支持摄像头）
2. 检查 `app.json` 中的权限配置
3. 用户需手动授权摄像头

### Q2：识别结果不准确？

**原因**：图片质量问题

**解决**：
1. 确保光线充足
2. 保持图片清晰
3. 图片大小适中（1-2MB）
4. 避免反光或模糊

### Q3：服务器部署失败？

**常见错误**：
- 端口被占用：`lsof -i :3000`
- 内存不足：升级服务器配置
- 依赖安装失败：使用 `npm ci`

**详细解决**：参见 `SERVER_DEPLOYMENT_GUIDE.md`

### Q4：云函数调用失败？

**解决**：
1. 检查云函数是否部署成功
2. 环境变量是否设置
3. 查看云函数日志
4. 确认 API 密钥有效

### Q5：如何提高识别速度？

**方案**：
1. 压缩图片（减小 base64 大小）
2. 升级服务器配置
3. 使用 CDN 加速
4. 优化 API 调用逻辑

## 📈 路线图

### 已完成 ✅
- [x] 小程序摄像头拍照功能
- [x] UI 界面和样式
- [x] 服务器代理方案
- [x] 云函数方案
- [x] 完整的部署文档
- [x] 安全配置指南

### 计划中 🚧
- [ ] 相册选择功能
- [ ] 批量识别功能
- [ ] 识别历史记录
- [ ] 结果分享功能
- [ ] 多模型支持
- [ ] 自定义模型训练

### 长期规划 📅
- [ ] iOS/Android 原生版本
- [ ] 桌面应用（Electron）
- [ ] Web 版本
- [ ] 小程序插件市场发布

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

### 贡献流程
1. Fork 本项目
2. 创建特性分支：`git checkout -b feature/your-feature`
3. 提交更改：`git commit -am 'Add some feature'`
4. 推送分支：`git push origin feature/your-feature`
5. 提交 Pull Request

### 代码规范
- 使用 ES6+ 语法
- 变量命名采用 camelCase
- 注释清晰完整
- 遵循原有代码风格

## 📄 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

## 🙏 致谢

感谢以下开源项目和服务：
- 微信小程序开发框架
- Express.js 框架
- 腾讯云 AI 服务
- 所有贡献者的支持

## 📞 联系我们

- 📧 Email：your-email@example.com
- 💬 微信：your-wechat-id
- 🐧 QQ：your-qq-number

## ⭐ 鸣谢

如果这个项目对你有帮助，请给个 ⭐ Star！

你的支持是我们持续更新的动力！

---

## 📌 重要提醒

1. **请勿在小程序代码中暴露 API 密钥**
2. **部署前请务必阅读安全指南**
3. **生产环境请配置 HTTPS**
4. **建议定期轮换 API 密钥**
5. **详细文档请查看各 `*.md` 文件**

---

**祝开发愉快！** 🎉
